<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur Synchro - Page Principale</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
        }

        header {
            background-color: #f4f4f4;
            padding: 10px;
            position: relative;
        }

        .dropdown {
            display: inline-block;
            position: relative;
        }

        .dropdown button {
            background-color: #f4f4f4;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
            z-index: 1;
            min-width: 160px;
            text-align: left;
        }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dropdown-content a:hover {
            background-color: #ddd;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        body.dark-theme {
            background-color: #2f2f39;
            color: #ffffff;
        }

        .dark-theme header {
            background-color: #5b5f65;
        }

        .dark-theme .dropdown button {
            background-color: #5b5f65;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        .dark-theme .fixed-resistance {
            background-color: #ddd3ff;
            color: #ffffff;
        }
        .dark-theme .resistance-percentage {
            background-color: #ddd3ff;
            color: #ffffff;
        }
        .spells-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            /* 3 colonnes */
            grid-template-rows: repeat(4, auto);
            /* 4 lignes */
            gap: 10px;
            padding: 10px;
            max-width: 150px;
            /* Largeur fixe pour garantir 4x3 */
            margin: 0 auto;
        }

        .spell {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            width: 100%;
            padding-top: 75%;
            /* RÃ©duction de la hauteur relative des cases */
            background-size: contain;
            /* Ajuste l'image Ã  la case */
            background-repeat: no-repeat;
            background-position: center;
            border: 1px solid transparent;
            cursor: pointer;
            position: relative;
            color: black;
        }

        .spell:hover::after {
            content: attr(data-spell-name);
            position: absolute;
            top: -30px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 10;
        }

        .spell.selected {
            filter: grayscale(100%);
            /* Applique le filtre gris uniquement Ã  l'image */
            background-color: transparent;
            /* Supprime le carrÃ© noir */
        }

        .spell::before {
            content: "";
            display: block;
            padding-top: 75%;
            /* Ratio rÃ©duit pour des cases plus petites */
        }

        .bottom-section {
            padding: 10px;
        }

        .bottom-section input {
            margin: 5px;
            padding: 10px;
            font-size: 14px;
            /* RÃ©duction de la taille des champs */
            width: 150px;
            /* RÃ©duction de la largeur des champs */
        }

        .damage-display {
            font-size: 20px;
            /* RÃ©duction de la taille du texte */
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <header>
        <div class="dropdown">
            <button>Menu</button>
            <div class="dropdown-content">
                <a href="#" onclick="openConfiguration()">Configuration</a>
                <a href="#" onclick="goToHome()">Accueil</a>
                <!-- <a href="#" onclick="resetSelection()">Nouvelle Synchro</a> -->
                <a href="#" id="theme-toggle"><span id="theme-icon">ðŸŒ™</span></a>
            </div>
        </div>
    </header>


    <div class="bottom-section">
        <input type="number" class="resistance-percentage" id="resistance-percentage" placeholder="% RÃ©sistance Air" oninput="calculateDamage()" />
        <input type="number" class="fixed-resistance" id="fixed-resistance" placeholder="RÃ©sistance fixe Air" oninput="calculateDamage()" />
        <button onclick="resetSelection()">Nouvelle Synchro</button>
        <div class="damage-display" id="damage-display">DÃ©gÃ¢ts : 0 </div>
    </div>

    <div class="spells-container" id="spells-container">
        <!-- Les sorts seront affichÃ©s dynamiquement ici -->
    </div>

    <script>
        const spellsData = {
            spell1: { Perturbation: 'images/pertubation.png', Rouage: 'images/rouage.png' },
            spell2: { Gelure: 'images/gelure.png', PoussiÃ¨re: 'images/poussiere.png' },
            spell3: { Souvenir: 'images/souvenir.png', Permutation: 'images/permutation.png' },
            spell4: { "Frappe du XÃ©lor": 'images/frappe_du_xelor.png', Pendule: 'images/pendule.png' },
            spell5: { TÃ©lÃ©portation: 'images/teleportation.png', Astrolabe: 'images/astrolabe.png' },
            spell6: { Engrenage: 'images/engrenage.png', "Compte-goutte": 'images/compte_goutte.png' },
            spell7: { "Fuite de temps": 'images/fuite_du_temps.png', PrÃ©monition: 'images/premonition.png' },
            spell8: { Rauleback: 'images/raulebaque.png', InstabilitÃ©: 'images/instabilite.png' },
            spell9: { Rembobinage: 'images/rembobinage.png', RÃ©mÃ©nance: 'images/remanance.png' },
            spell10: { Paradoxe: 'images/paradoxe.png', Faille: 'images/faille.png' },
            spell11: { Distorsion: 'images/distortion.png', "Sables du temps": 'images/sables_du_temps.png' },
            spell12: { DÃ©synchronisation: 'images/desynchronisation.png', "Espaces-temps": 'images/espace_temps.png' }
        };

        function loadSpells() {
            const config = JSON.parse(localStorage.getItem('synchroConfig')) || {};
            const spellsContainer = document.getElementById('spells-container');

            Object.keys(spellsData).forEach(spellKey => {
                const variant = config.spells ? config.spells[spellKey] : Object.keys(spellsData[spellKey])[0];
                const imageUrl = spellsData[spellKey][variant];

                const spellElement = document.createElement('div');
                spellElement.classList.add('spell');
                spellElement.style.backgroundImage = `url(${imageUrl})`;
                spellElement.setAttribute('data-spell-name', variant);

                spellElement.onclick = () => toggleSpell(spellElement);
                spellsContainer.appendChild(spellElement);
            });
        }

        function openConfiguration() {
            window.location.href = "configuration.html";
        }

        function goToHome() {
            alert('Redirection vers l\'accueil (Ã  implÃ©menter).');
        }

        function resetSelection() {
            const spells = document.querySelectorAll('.spell');
            spells.forEach(spell => spell.classList.remove('selected'));
            document.getElementById('damage-display').innerText = 'DÃ©gÃ¢ts : 0';
        }

        function toggleSpell(element) {
            element.classList.toggle('selected');
            calculateDamage();
        }

        function calculateDamage() {
            const tfCount = document.querySelectorAll('.spell.selected').length; // Nombre de TÃ©lÃ©frags sÃ©lectionnÃ©s
            const baseDamage = 208; // DÃ©gÃ¢ts de base avec 0 TÃ©lÃ©frag
            const resistancePercentage = parseFloat(document.getElementById('resistance-percentage').value) || 0; // RÃ©sistance en %
            const fixedResistance = parseFloat(document.getElementById('fixed-resistance').value) || 0; // RÃ©sistance fixe

            // Calcul des dÃ©gÃ¢ts en fonction des TÃ©lÃ©frags
            let damageMultiplier = baseDamage; // Par dÃ©faut, dÃ©gÃ¢ts pour 0 ou 1 TÃ©lÃ©frag
            if (tfCount >= 2) {
                damageMultiplier = 208 + 416 * (tfCount - 1);
            }

            // Application des rÃ©sistances
            const reducedDamage = damageMultiplier * (1 - resistancePercentage / 100) - fixedResistance;
            const finalDamage = Math.max(0, reducedDamage); // EmpÃªche les dÃ©gÃ¢ts nÃ©gatifs

            // Affiche les dÃ©gÃ¢ts finaux
            document.getElementById('damage-display').innerText = `DÃ©gÃ¢ts : ${finalDamage.toFixed(0)}`;
        }

        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const body = document.body;

        if (localStorage.getItem('darkTheme') === 'true') {
            body.classList.add('dark-theme');
            themeIcon.textContent = 'ðŸŒž';
            themeToggle.textContent = 'ðŸŒž';
        }

        themeToggle.addEventListener('click', (e) => {
            e.preventDefault();
            body.classList.toggle('dark-theme');
            const isDark = body.classList.contains('dark-theme');

            themeIcon.textContent = isDark ? 'ðŸŒž' : 'ðŸŒ™';
            themeToggle.textContent = isDark ? 'ðŸŒž' : 'ðŸŒ™';

            localStorage.setItem('darkTheme', isDark);
        });

        window.onload = loadSpells;
    </script>
</body>

</html>